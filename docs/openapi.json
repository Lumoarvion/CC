{
  "openapi": "3.0.3",
  "info": {
    "title": "Lumo - CConnect",
    "version": "1.0.0",
    "description": "Lumo CConnect REST API: Auth, Users, Posts"
  },
  "servers": [
    {
      "url": "/api"
    }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Authentication and OTP"
    },
    {
      "name": "Users",
      "description": "User profile and relations"
    },
    {
      "name": "Posts",
      "description": "Posting, likes and comments"
    },
    {
      "name": "Admin",
      "description": "Super-admin only operations"
    },
    {
      "name": "Media",
      "description": "Media storage and uploads"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "description": "",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/admins": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/departments/internal": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/users/{id}": {
      "get": {
        "description": "",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserSummary"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "User ID"
          }
        ]
      },
      "delete": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ]
      }
    },
    "/announcements": {
      "get": {
        "tags": [
          "Posts"
        ],
        "summary": "List announcements (public)",
        "description": "Returns non-archived announcements for any authenticated user.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "required": false
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Announcements",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnouncementListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/announcements/{id}": {
      "patch": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      },
      "delete": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/announcements/{id}/archive": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/announcements/{id}/restore": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/auth/register": {
      "post": {
        "description": "roleKey takes precedence over accountType (must match if both provided). Students (roleKey=3) require degreeId, yearOfJoining (aka academicYear), and studentId; Staff (roleKey=2) may omit degreeId. departmentId is required for all. gender is optional. fullName also accepts legacy alias name. Note: the field is roleKey, not roleId. Usernames must be 3-30 characters long and may contain letters, numbers, dot, underscore, or hyphen (no spaces).",
        "parameters": [
          {
            "name": "user-agent",
            "in": "header",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRegisterResponse"
                },
                "example": {
                  "id": 42,
                  "name": "Alice Doe",
                  "username": "alice.doe",
                  "email": "alice@example.edu",
                  "degreeId": 101,
                  "departmentId": 5,
                  "designationId": 301,
                  "empId": "EMP-2024-0001",
                  "gender": "female",
                  "yearOfJoining": 2023,
                  "studentId": "STU-2023-0001"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "missingFields": {
                    "value": {
                      "message": "All fields are required"
                    }
                  },
                  "otpTicketRequired": {
                    "value": {
                      "message": "otpTicket is required (10 digits)"
                    }
                  },
                  "ticketInvalid": {
                    "value": {
                      "message": "ticket_invalid"
                    }
                  },
                  "ticketExpired": {
                    "value": {
                      "message": "ticket_expired"
                    }
                  },
                  "ticketUsed": {
                    "value": {
                      "message": "ticket_used"
                    }
                  },
                  "conflict": {
                    "value": {
                      "message": "roleKey and accountType conflict"
                    }
                  },
                  "unsupportedRole": {
                    "value": {
                      "message": "Unsupported roleKey"
                    }
                  },
                  "degreeRequired": {
                    "value": {
                      "message": "degreeId is required"
                    }
                  },
                  "invalidDegree": {
                    "value": {
                      "message": "Invalid degreeId"
                    }
                  },
                  "departmentRequired": {
                    "value": {
                      "message": "departmentId is required"
                    }
                  },
                  "invalidDepartment": {
                    "value": {
                      "message": "Invalid departmentId"
                    }
                  },
                  "roleNotConfigured": {
                    "value": {
                      "message": "Role not configured"
                    }
                  },
                  "invalidUsername": {
                    "value": {
                      "message": "Username must be 3-30 characters and can include letters, numbers, dot, underscore, or hyphen."
                    }
                  }
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "emailConflict": {
                    "value": {
                      "message": "Email already in use"
                    }
                  },
                  "usernameConflict": {
                    "value": {
                      "message": "Username already in use"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Registration failed"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthRegisterRequest"
              },
              "examples": {
                "student": {
                  "summary": "Student registration (roleKey=3)",
                  "value": {
                    "fullName": "Alice Doe",
                    "username": "alice.doe",
                    "email": "alice@example.edu",
                    "password": "secret",
                    "otpTicket": "1234567890",
                    "roleKey": 3,
                    "degreeId": 101,
                    "departmentId": 5,
                    "gender": "female",
                    "yearOfJoining": 2023,
                    "studentId": "STU-2023-0001"
                  }
                },
                "staff": {
                  "summary": "Staff registration (roleKey=2)",
                  "value": {
                    "fullName": "Prof Bob",
                    "username": "prof_bob",
                    "email": "bob@example.edu",
                    "password": "secret",
                    "otpTicket": "1234567890",
                    "roleKey": 2,
                    "departmentId": 2,
                    "designationId": 301,
                    "empId": "EMP-2024-0001",
                    "gender": "male"
                  }
                }
              }
            }
          }
        },
        "tags": [
          "Auth"
        ],
        "summary": "Create a new account"
      }
    },
    "/auth/login": {
      "post": {
        "description": "",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthLoginResponse"
                },
                "example": {
                  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                  "user": {
                    "id": 42,
                    "name": "Alice Doe",
                    "username": "alice",
                    "email": "alice@example.edu",
                    "degreeId": 101,
                    "departmentId": 5
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Invalid credentials"
                }
              }
            }
          }
        },
        "tags": [
          "Auth"
        ],
        "summary": "Login with email/username and password",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthLoginRequest"
              }
            }
          }
        }
      }
    },
    "/auth/request-otp": {
      "post": {
        "description": "",
        "responses": {
          "200": {
            "description": "OTP sent",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtpRequestResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid email",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Invalid email"
                }
              }
            }
          },
          "403": {
            "description": "Domain not allowed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Email domain is not allowed"
                }
              }
            }
          },
          "409": {
            "description": "Already registered",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Email already registered. Please login."
                }
              }
            }
          },
          "429": {
            "description": "Too Many Requests",
            "headers": {
              "Retry-After": {
                "description": "Seconds to wait before retrying",
                "schema": {
                  "type": "integer"
                },
                "example": 120
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "OTP recently sent. Try again in 120s"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Internal server error"
                }
              }
            }
          },
          "502": {
            "description": "Failed to send email",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Failed to send OTP email"
                }
              }
            }
          }
        },
        "tags": [
          "Auth"
        ],
        "summary": "Request OTP to email",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OtpRequest"
              },
              "example": {
                "email": "student@example.edu"
              }
            }
          }
        }
      }
    },
    "/auth/verify-otp": {
      "post": {
        "description": "",
        "responses": {
          "200": {
            "description": "Verified",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtpVerifyResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "examples": {
                  "missing": {
                    "value": {
                      "error": "email and otp are required"
                    }
                  },
                  "invalid": {
                    "value": {
                      "error": "Invalid OTP"
                    }
                  },
                  "expired": {
                    "value": {
                      "error": "OTP expired"
                    }
                  },
                  "none": {
                    "value": {
                      "error": "No active OTP. Request a new one."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Internal server error"
                }
              }
            }
          }
        },
        "tags": [
          "Auth"
        ],
        "summary": "Verify OTP code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OtpVerifyRequest"
              },
              "example": {
                "email": "student@example.edu",
                "otp": "1234"
              }
            }
          }
        }
      }
    },
    "/auth/reference-data": {
      "get": {
        "description": "Provide roleKey=3 (Student) to receive degrees + departments; roleKey=2 (Staff) to receive designations + departments.",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReferenceDataResponse"
                },
                "examples": {
                  "student": {
                    "summary": "Student reference data",
                    "value": {
                      "roleKey": 3,
                      "degrees": [
                        {
                          "degreeId": 101,
                          "degreeAbbr": "BSc",
                          "degreeName": "Bachelor of Science",
                          "level": 1
                        }
                      ],
                      "departments": [
                        {
                          "departmentId": 5,
                          "departmentName": "Computer Science"
                        }
                      ]
                    }
                  },
                  "staff": {
                    "summary": "Staff reference data",
                    "value": {
                      "roleKey": 2,
                      "departments": [
                        {
                          "departmentId": 5,
                          "departmentName": "Computer Science"
                        }
                      ],
                      "designations": [
                        {
                          "designationId": 1,
                          "designationName": "Professor",
                          "isTeaching": true
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Invalid or missing roleKey (2=Staff, 3=Student)"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimpleError"
                },
                "example": {
                  "error": "Internal server error"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "roleKey",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer",
              "enum": [
                2,
                3
              ],
              "example": 3
            },
            "description": "2=Staff, 3=Student"
          }
        ],
        "tags": [
          "Auth"
        ],
        "summary": "Fetch reference data by roleKey"
      }
    },
    "/users/me": {
      "get": {
        "description": "",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserSummary"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ]
      },
      "patch": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ]
      }
    },
    "/users/me/avatar": {
      "post": {
        "description": "",
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarUpdateResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "avatar": {
                    "type": "string",
                    "format": "binary"
                  }
                },
                "required": [
                  "avatar"
                ]
              }
            }
          }
        }
      },
      "delete": {
        "description": "",
        "responses": {
          "200": {
            "description": "Deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Ok"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ]
      }
    },
    "/users/me/delete-request": {
      "post": {
        "description": "Verifies the current password, records reason/IP/UA metadata, and issues a deletion requestId plus 4-digit OTP that expires after DELETE_OTP_TTL_MIN minutes.",
        "responses": {
          "200": {
            "description": "OTP issued",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteRequestResponse"
                },
                "examples": {
                  "production": {
                    "value": {
                      "requestId": "01f973c50f4ca310f90b0ca142111c55",
                      "expiresAt": "2025-10-01T18:14:57.040Z"
                    },
                    "description": "Response in production where OTP is emailed only."
                  },
                  "nonProduction": {
                    "value": {
                      "requestId": "01f973c50f4ca310f90b0ca142111c55",
                      "expiresAt": "2025-10-01T18:14:57.040Z",
                      "otp": "7732"
                    },
                    "description": "Response when INCLUDE_OTP_IN_RESPONSE=true or NODE_ENV != production."
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation failed or no eligible pending request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Password is required"
                }
              }
            }
          },
          "401": {
            "description": "Password incorrect",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Invalid password"
                }
              }
            }
          },
          "404": {
            "description": "User record not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "User not found"
                }
              }
            }
          },
          "410": {
            "description": "Account already deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Account already deleted"
                }
              }
            }
          },
          "500": {
            "description": "Unable to process request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to request account deletion"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ],
        "summary": "Request account deletion (OTP)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteRequestBody"
              },
              "example": {
                "password": "P@ssw0rd123!",
                "reason": "Graduated; no longer need access"
              }
            }
          }
        }
      }
    },
    "/users/me/delete-confirm": {
      "post": {
        "description": "Consumes the requestId + OTP, archives the user snapshot, scrubs personal data, bumps jwtVersion, and attempts to send a confirmation email (best-effort).",
        "responses": {
          "200": {
            "description": "Account deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteConfirmResponse"
                },
                "example": {
                  "status": "deleted",
                  "confirmedAt": "2025-10-01T18:00:11.933Z",
                  "mailerError": false
                }
              }
            }
          },
          "400": {
            "description": "Invalid requestId/otp or no pending request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Invalid requestId or otp"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized or session revoked",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Invalid or expired token"
                }
              }
            }
          },
          "404": {
            "description": "User record not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "User not found"
                }
              }
            }
          },
          "410": {
            "description": "Request expired or account already deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Account already deleted"
                }
              }
            }
          },
          "500": {
            "description": "Failed to confirm deletion request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to confirm account deletion"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Users"
        ],
        "summary": "Confirm account deletion",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteConfirmRequest"
              },
              "example": {
                "requestId": "01f973c50f4ca310f90b0ca142111c55",
                "otp": "7732"
              }
            }
          }
        }
      }
    },
    "/{id}/followers": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/following": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/posts": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/replies": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/media": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/likes": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/users/{id}/follow": {
      "post": {
        "tags": [
          "Users"
        ],
        "summary": "Follow a user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "User ID to follow"
          }
        ],
        "responses": {
          "200": {
            "description": "Followed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FollowActionResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "404": {
            "description": "User not found"
          }
        }
      },
      "delete": {
        "tags": [
          "Users"
        ],
        "summary": "Unfollow a user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "User ID to unfollow"
          }
        ],
        "responses": {
          "200": {
            "description": "Unfollowed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FollowActionResponse"
                }
              }
            }
          }
        }
      }
    },
    "/posts": {
      "post": {
        "description": "Creates a standard post for the authenticated user. Content is trimmed and deduplicated against the most recent post. Include the `metadata.r2Key` from `/media/presign` so media objects can be cleaned up if a post is edited or deleted. Set `quotedPostId` to reshare another post (omit `content`/attachments for a silent repost or include them for a quote post) and `parentPostId` to start a threaded reply.",
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Post"
                },
                "example": {
                  "id": 123,
                  "content": "Excited for the #Hackathon with @superadmin!",
                  "postType": "standard",
                  "audienceScope": {
                    "target": {
                      "scope": "profile"
                    },
                    "interests": [
                      "topic:events",
                      "department:1"
                    ]
                  },
                  "mentions": [
                    "superadmin"
                  ],
                  "hashtags": [
                    "hackathon"
                  ],
                  "urls": [
                    "https://example.edu/events/hack"
                  ],
                  "media": [
                    {
                      "id": 1,
                      "type": "image",
                      "url": "https://cdn.example.edu/media/posts/hackathon-poster.webp",
                      "metadata": {
                        "r2Key": "users/4/posts/hackathon-poster.webp",
                        "contentType": "image/webp",
                        "size": 104857,
                        "width": 1024,
                        "height": 576,
                        "order": 0
                      }
                    }
                  ],
                  "quotedPostId": null,
                  "parentPostId": null,
                  "isArchived": false,
                  "announcementTypeId": null,
                  "userId": 4,
                  "user": {
                    "id": 4,
                    "fullName": "Ava Admin",
                    "username": "ava.admin"
                  },
                  "createdAt": "2025-10-06T17:00:00.000Z",
                  "updatedAt": "2025-10-06T17:00:00.000Z"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "lengthExceeded": {
                    "summary": "Content too long",
                    "value": {
                      "message": "content exceeds 2000 characters"
                    }
                  },
                  "mediaRule": {
                    "summary": "Attachment rule violated",
                    "value": {
                      "message": "video posts may include only one attachment"
                    }
                  },
                  "invalidQuoted": {
                    "summary": "Referenced post is archived or missing",
                    "value": {
                      "message": "quoted post not found"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "missing": {
                    "value": {
                      "message": "Missing token"
                    }
                  },
                  "invalid": {
                    "value": {
                      "message": "Invalid or expired token"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Account disabled",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Account disabled"
                }
              }
            }
          },
          "404": {
            "description": "Referenced post not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "parent post not found"
                }
              }
            }
          },
          "409": {
            "description": "Duplicate content",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Duplicate content detected"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Too many posts, try again in a minute"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to create post"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Posts"
        ],
        "summary": "Create a post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PostCreate"
              },
              "example": {
                "content": "Excited for the #Hackathon with @superadmin!",
                "attachments": [
                  {
                    "type": "image",
                    "url": "https://cdn.example.edu/media/posts/hackathon-poster.webp",
                    "metadata": {
                      "r2Key": "users/4/posts/hackathon-poster.webp",
                      "contentType": "image/webp",
                      "size": 104857,
                      "width": 1024,
                      "height": 576
                    }
                  }
                ]
              }
            }
          }
        }
      }
    },
    "/{id}/repost": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/quote": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/reply": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/posts/feed": {
      "get": {
        "description": "Returns a single paginated home feed ordered as: active announcements first (capped), followed-users unseen posts, discovery unseen posts, followed-users seen posts, then discovery seen posts. Archived posts are excluded; discovery pulls from recent unfollowed standard posts.",
        "responses": {
          "200": {
            "description": "Feed page",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PostFeedResponse"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to load feed"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Posts"
        ],
        "summary": "Home feed",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "description": "Page number (default 1)"
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 50
            },
            "description": "Items per page (default 10, max 50)"
          }
        ]
      }
    },
    "/saved": {
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/archive": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/restore": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/posts/{id}/like": {
      "post": {
        "description": "Adds a like from the current user. The operation is idempotent; repeating it keeps the post liked.",
        "responses": {
          "200": {
            "description": "Liked",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PostEngagementResponse"
                },
                "example": {
                  "ok": true,
                  "likeCount": 12,
                  "viewerHasLiked": true
                }
              }
            }
          },
          "400": {
            "description": "Invalid post id",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "invalid post id"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Missing token"
                }
              }
            }
          },
          "403": {
            "description": "Account disabled",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Account disabled"
                }
              }
            }
          },
          "404": {
            "description": "Post not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "post not found"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to like post"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Posts"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Post ID"
          }
        ],
        "summary": "Like a post"
      },
      "delete": {
        "description": "Removes the user's like. Returns `ok: true` even if the post was not previously liked.",
        "responses": {
          "200": {
            "description": "Unliked",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PostEngagementResponse"
                },
                "example": {
                  "ok": true,
                  "likeCount": 11,
                  "viewerHasLiked": false
                }
              }
            }
          },
          "400": {
            "description": "Invalid post id",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "invalid post id"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Missing token"
                }
              }
            }
          },
          "403": {
            "description": "Account disabled",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Account disabled"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to unlike post"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Posts"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Post ID"
          }
        ],
        "summary": "Unlike a post"
      }
    },
    "/{id}/save": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      },
      "delete": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/{id}/pin": {
      "post": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      },
      "delete": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/posts/{id}/comments": {
      "post": {
        "description": "Adds a text comment to the specified post. Content is trimmed and limited to 2000 characters.",
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Comment"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "missing": {
                    "value": {
                      "message": "content required"
                    }
                  },
                  "tooLong": {
                    "value": {
                      "message": "comment exceeds 2000 characters"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Missing token"
                }
              }
            }
          },
          "403": {
            "description": "Account disabled",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Account disabled"
                }
              }
            }
          },
          "404": {
            "description": "Post not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "post not found"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to add comment"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Posts"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Post ID"
          }
        ],
        "summary": "Comment on a post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CommentCreate"
              },
              "example": {
                "content": "Team Phoenix has 3 open slots  DM me if you want in!"
              }
            }
          }
        }
      },
      "get": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Posts"
        ]
      }
    },
    "/{postId}/comments/{commentId}": {
      "patch": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      },
      "delete": {
        "description": "",
        "responses": {
          "default": {
            "description": ""
          }
        }
      }
    },
    "/media/presign": {
      "post": {
        "description": "Validates the incoming filename, MIME type, and optional file size before issuing a Cloudflare R2 presigned PUT URL. Attach the returned `objectKey` to post metadata so the backend can manage media lifecycle.",
        "responses": {
          "200": {
            "description": "Upload prepared",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MediaPresignResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "missingFilename": {
                    "summary": "No filename submitted",
                    "value": {
                      "message": "filename is required"
                    }
                  },
                  "missingMime": {
                    "summary": "No content type",
                    "value": {
                      "message": "contentType is required"
                    }
                  },
                  "unsupportedMime": {
                    "summary": "Disallowed MIME",
                    "value": {
                      "message": "Unsupported content type"
                    }
                  },
                  "tooLarge": {
                    "summary": "Size exceeds limit",
                    "value": {
                      "message": "File exceeds 50MB limit"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Missing token"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to prepare upload"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Media"
        ],
        "summary": "Generate upload URL",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MediaPresignRequest"
              }
            }
          }
        }
      }
    },
    "/admin/admins": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Create admin account",
        "description": "Create an admin (roleKey=1). Only super-admins (roleKey=0) may call this endpoint.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "fullName",
                  "username",
                  "email",
                  "password",
                  "departmentId"
                ],
                "properties": {
                  "fullName": {
                    "type": "string",
                    "minLength": 1
                  },
                  "username": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 30
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8
                  },
                  "departmentId": {
                    "type": "integer",
                    "minimum": 1
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Admin created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "fullName": {
                      "type": "string"
                    },
                    "username": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string",
                      "format": "email"
                    },
                    "roleKey": {
                      "type": "integer",
                      "example": 1
                    },
                    "department": {
                      "type": "object",
                      "properties": {
                        "departmentId": {
                          "type": "integer"
                        },
                        "departmentName": {
                          "type": "string"
                        },
                        "isVisible": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error"
          },
          "401": {
            "description": "Authentication required"
          },
          "403": {
            "description": "Forbidden"
          },
          "409": {
            "description": "Conflict"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/departments/internal": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List internal departments",
        "description": "Return active departments marked isVisible=false (internal use). Only super-admins may call this endpoint.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Internal departments",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "count": {
                      "type": "integer"
                    },
                    "departments": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "departmentId": {
                            "type": "integer"
                          },
                          "departmentName": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required"
          },
          "403": {
            "description": "Forbidden"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/announcements": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Create announcement",
        "description": "Create a new announcement post. Admin or super-admin only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AnnouncementCreateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnouncementResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List announcements",
        "description": "Paginated list of announcements with optional archived records.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "description": "Page number (default 1)"
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            },
            "description": "Page size (default 10, max 100)"
          },
          {
            "name": "includeArchived",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            },
            "description": "Include archived announcements"
          }
        ],
        "responses": {
          "200": {
            "description": "Announcements",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnouncementListResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/admin/announcements/{id}": {
      "patch": {
        "tags": [
          "Admin"
        ],
        "summary": "Update announcement",
        "description": "Modify announcement content, type, or scheduling. Admin or super-admin only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Announcement ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AnnouncementUpdateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnouncementResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error"
          },
          "403": {
            "description": "Forbidden"
          },
          "404": {
            "description": "Announcement not found"
          }
        }
      }
    },
    "/posts/{id}/archive": {
      "post": {
        "tags": [
          "Posts"
        ],
        "summary": "Archive a post",
        "description": "Marks a post as archived so it no longer appears in feeds. Only the owner or admins may call this endpoint.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Post ID"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PostArchiveRequest"
              },
              "example": {
                "reason": "Outdated announcement"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Archived",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PostArchiveResponse"
                },
                "example": {
                  "ok": true,
                  "post": {
                    "id": 123,
                    "isArchived": true,
                    "archivedAt": "2025-11-02T08:31:42.000Z",
                    "archivedBy": "user:4",
                    "archiveReason": "Outdated announcement"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "invalid post id"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Missing token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "forbidden"
                }
              }
            }
          },
          "404": {
            "description": "Post not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "post not found"
                }
              }
            }
          },
          "409": {
            "description": "Already archived",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "post already archived"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to archive post"
                }
              }
            }
          }
        }
      }
    },
    "/posts/{id}/restore": {
      "post": {
        "tags": [
          "Posts"
        ],
        "summary": "Restore an archived post",
        "description": "Clears the archive flag so the post returns to feeds.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Post ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Restored",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PostArchiveResponse"
                },
                "example": {
                  "ok": true,
                  "post": {
                    "id": 123,
                    "isArchived": false
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "invalid post id"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Missing token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "forbidden"
                }
              }
            }
          },
          "404": {
            "description": "Post not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "post not found"
                }
              }
            }
          },
          "409": {
            "description": "Post is not archived",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "post is not archived"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to restore post"
                }
              }
            }
          }
        }
      }
    },
    "/posts/{id}": {
      "delete": {
        "tags": [
          "Posts"
        ],
        "summary": "Delete a post permanently",
        "description": "Removes the post and its related entities permanently.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Post ID"
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "invalid post id"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Missing token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "forbidden"
                }
              }
            }
          },
          "404": {
            "description": "Post not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "post not found"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "message": "Failed to delete post"
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}/followers": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "List followers",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Followers",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FollowListResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid user id"
          }
        }
      }
    },
    "/users/{id}/following": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "List following",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Following",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FollowListResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid user id"
          }
        }
      }
    },
    "/notifications": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "List notifications for current user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Notifications",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/notifications/{id}/read": {
      "patch": {
        "tags": [
          "Users"
        ],
        "summary": "Mark a notification as read",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationReadResponse"
                }
              }
            }
          },
          "404": {
            "description": "Notification not found"
          }
        }
      }
    },
    "/notifications/read-all": {
      "patch": {
        "tags": [
          "Users"
        ],
        "summary": "Mark all notifications as read",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationReadResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "message": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "message": {
                "type": "string",
                "example": "Bad request"
              }
            }
          }
        }
      },
      "SimpleError": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "error": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "error": {
                "type": "string",
                "example": "Something went wrong"
              }
            }
          }
        }
      },
      "Ok": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "ok": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "ok": {
                "type": "boolean",
                "example": true
              }
            }
          }
        }
      },
      "UserSummary": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              },
              "name": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "username": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "email": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "email"
                  }
                }
              },
              "degreeId": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  }
                }
              },
              "departmentId": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  }
                }
              },
              "designationId": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "id": {
                "type": "number",
                "example": 42
              },
              "name": {
                "type": "string",
                "example": "Alice Doe"
              },
              "username": {
                "type": "string",
                "example": "alice"
              },
              "email": {
                "type": "string",
                "example": "alice@example.edu"
              },
              "degreeId": {
                "type": "number",
                "example": 101
              },
              "departmentId": {
                "type": "number",
                "example": 5
              },
              "designationId": {
                "type": "number",
                "example": 301
              }
            }
          }
        }
      },
      "UserSelf": {
        "type": "object",
        "properties": {
          "allOf": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "example": "object"
                },
                "properties": {
                  "type": "object",
                  "properties": {
                    "email": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "type": "string",
                          "example": "string"
                        },
                        "format": {
                          "type": "string",
                          "example": "email"
                        }
                      }
                    }
                  }
                },
                "required": {
                  "type": "array",
                  "example": [
                    "email"
                  ],
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "description": {
            "type": "string",
            "example": "Fields visible to the authenticated user about themselves."
          }
        }
      },
      "AuthRegisterRequest": {
        "type": "object",
        "description": "Payload for /auth/register. Usernames are trimmed and validated before duplicate checks.",
        "required": [
          "fullName",
          "username",
          "email",
          "password",
          "otpTicket"
        ],
        "properties": {
          "fullName": {
            "type": "string",
            "description": "Display name shown in UI."
          },
          "username": {
            "type": "string",
            "minLength": 3,
            "maxLength": 30,
            "pattern": "^[A-Za-z0-9._-]+$",
            "description": "Case-sensitive handle. Trimmed before persistence. Allowed characters: letters, numbers, dot, underscore, hyphen.",
            "example": "alice.doe"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Trimmed and lowercased during registration."
          },
          "password": {
            "type": "string",
            "format": "password",
            "description": "Minimum 8 characters recommended."
          },
          "otpTicket": {
            "type": "string",
            "pattern": "^[0-9]{10}$",
            "description": "10-digit ticket from /auth/verify-otp."
          },
          "roleKey": {
            "type": "integer",
            "enum": [
              2,
              3
            ],
            "description": "2 = Staff, 3 = Student. Must align with accountType if present."
          },
          "accountType": {
            "type": "string",
            "nullable": true,
            "description": "Legacy string alias for roleKey."
          },
          "degreeId": {
            "type": "integer",
            "nullable": true
          },
          "departmentId": {
            "type": "integer",
            "nullable": true
          },
          "designationId": {
            "type": "integer",
            "nullable": true
          },
          "empId": {
            "type": "string",
            "nullable": true
          },
          "gender": {
            "type": "string",
            "nullable": true,
            "description": "male | female | other | prefer_not_to_say"
          },
          "yearOfJoining": {
            "type": "integer",
            "nullable": true
          },
          "academicYear": {
            "type": "integer",
            "nullable": true
          },
          "studentId": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "OtpRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "email"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "email": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "email"
                  },
                  "description": {
                    "type": "string",
                    "example": "Email to receive the OTP. Normalized to lowercase."
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "email": {
                "type": "string",
                "example": "student@example.edu"
              }
            }
          }
        }
      },
      "OtpRequestResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "message": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "description": {
                    "type": "string",
                    "example": "Status message suitable for UI display."
                  }
                }
              },
              "email": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "email"
                  }
                }
              },
              "domain": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "description": {
                    "type": "string",
                    "example": "Brand/organization domain inferred from email."
                  }
                }
              },
              "expiresInSeconds": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "description": {
                    "type": "string",
                    "example": "Seconds until the OTP expires."
                  }
                }
              },
              "otp": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "description": {
                    "type": "string",
                    "example": "4-digit OTP echoed in non-production environments or when explicitly enabled."
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "message": {
                "type": "string",
                "example": "OTP sent to email"
              },
              "email": {
                "type": "string",
                "example": "student@example.edu"
              },
              "domain": {
                "type": "string",
                "example": "example.edu"
              },
              "expiresInSeconds": {
                "type": "number",
                "example": 900
              },
              "otp": {
                "type": "string",
                "example": "1234"
              }
            }
          }
        }
      },
      "OtpVerifyRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "email",
              "otp"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "email": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "email"
                  }
                }
              },
              "otp": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "description": {
                    "type": "string",
                    "example": "4-digit code from email."
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "email": {
                "type": "string",
                "example": "student@example.edu"
              },
              "otp": {
                "type": "string",
                "example": "1234"
              }
            }
          }
        }
      },
      "OtpVerifyResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "message": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "email": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "email"
                  }
                }
              },
              "roles": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "array"
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "example": "object"
                      },
                      "properties": {
                        "type": "object",
                        "properties": {
                          "roleKey": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "integer"
                              }
                            }
                          },
                          "roleName": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          },
                          "description": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "otpTicket": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "description": {
                    "type": "string",
                    "example": "10-digit ticket required for registration."
                  }
                }
              },
              "expiresInSeconds": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "message": {
                "type": "string",
                "example": "OTP verified"
              },
              "email": {
                "type": "string",
                "example": "student@example.edu"
              },
              "roles": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "roleKey": {
                      "type": "number",
                      "example": 3
                    },
                    "roleName": {
                      "type": "string",
                      "example": "Student"
                    }
                  }
                }
              },
              "otpTicket": {
                "type": "string",
                "example": "0123456789"
              },
              "expiresInSeconds": {
                "type": "number",
                "example": 1800
              }
            }
          }
        }
      },
      "ReferenceDataResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "description": {
            "type": "string",
            "example": "Role-specific lookup data surfaced after OTP verification."
          },
          "properties": {
            "type": "object",
            "properties": {
              "roleKey": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              },
              "degrees": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "array"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "example": "object"
                      },
                      "properties": {
                        "type": "object",
                        "properties": {
                          "degreeId": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "integer"
                              }
                            }
                          },
                          "degreeAbbr": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          },
                          "degreeName": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          },
                          "level": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "integer"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "departments": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "array"
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "example": "object"
                      },
                      "properties": {
                        "type": "object",
                        "properties": {
                          "departmentId": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "integer"
                              }
                            }
                          },
                          "departmentName": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "designations": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "array"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "example": "object"
                      },
                      "properties": {
                        "type": "object",
                        "properties": {
                          "designationId": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "integer"
                              }
                            }
                          },
                          "designationName": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          },
                          "isTeaching": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "boolean"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "AuthRegisterResponse": {
        "type": "object",
        "description": "Response issued after successful registration.",
        "properties": {
          "id": {
            "type": "integer"
          },
          "name": {
            "type": "string"
          },
          "username": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "degreeId": {
            "type": "integer",
            "nullable": true
          },
          "departmentId": {
            "type": "integer",
            "nullable": true
          },
          "designationId": {
            "type": "integer",
            "nullable": true
          },
          "empId": {
            "type": "string",
            "nullable": true
          },
          "gender": {
            "type": "string",
            "nullable": true
          },
          "yearOfJoining": {
            "type": "integer",
            "nullable": true
          },
          "studentId": {
            "type": "string",
            "nullable": true
          }
        },
        "example": {
          "id": 42,
          "name": "Alice Doe",
          "username": "alice.doe",
          "email": "alice@example.edu",
          "degreeId": 101,
          "departmentId": 5,
          "designationId": 301,
          "empId": "EMP-2024-0001",
          "gender": "female",
          "yearOfJoining": 2023,
          "studentId": "STU-2023-0001"
        }
      },
      "AvatarUpdateResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "ok": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  }
                }
              },
              "avatarUrl": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "avatarUrlFull": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "ok": {
                "type": "boolean",
                "example": true
              },
              "avatarUrl": {
                "type": "string",
                "example": "/uploads/avatars/abc-256.webp"
              },
              "avatarUrlFull": {
                "type": "string",
                "example": "/uploads/avatars/abc-1024.webp"
              }
            }
          }
        }
      },
      "PostCreate": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "content"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "content": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "attachments": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "array"
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "example": "object"
                      },
                      "required": {
                        "type": "array",
                        "example": [
                          "type",
                          "url"
                        ],
                        "items": {
                          "type": "string"
                        }
                      },
                      "properties": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          },
                          "url": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "example": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "content": {
                "type": "string",
                "example": "Hello campus!"
              },
              "attachments": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "example": "image"
                    },
                    "url": {
                      "type": "string",
                      "example": "https://example.com/pic.jpg"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "Post": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "content": {
            "type": "string"
          },
          "postType": {
            "type": "string",
            "enum": [
              "standard",
              "announcement"
            ]
          },
          "pinnedUntil": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "audienceScope": {
            "type": "object",
            "additionalProperties": true
          },
          "mentions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Lowercase usernames referenced with @"
          },
          "hashtags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Lowercase hashtag slugs (no # symbol)"
          },
          "urls": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Normalized https URLs detected in content"
          },
          "media": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PostMedia"
            }
          },
          "quotedPostId": {
            "type": "integer",
            "nullable": true
          },
          "quotedPost": {
            "$ref": "#/components/schemas/PostSummary",
            "nullable": true
          },
          "parentPostId": {
            "type": "integer",
            "nullable": true
          },
          "parentPost": {
            "$ref": "#/components/schemas/PostSummary",
            "nullable": true
          },
          "isArchived": {
            "type": "boolean"
          },
          "archivedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "archivedBy": {
            "type": "string",
            "nullable": true
          },
          "archiveReason": {
            "type": "string",
            "nullable": true
          },
          "announcementTypeId": {
            "type": "integer",
            "nullable": true
          },
          "announcementType": {
            "$ref": "#/components/schemas/AnnouncementTypeSummary",
            "nullable": true
          },
          "userId": {
            "type": "integer"
          },
          "user": {
            "$ref": "#/components/schemas/PostAuthor",
            "nullable": true
          },
          "likeCount": {
            "type": "integer",
            "minimum": 0,
            "description": "Running total of likes (materialized from post_stats)."
          },
          "commentCount": {
            "type": "integer",
            "minimum": 0,
            "description": "Running total of comments (materialized)."
          },
          "quoteCount": {
            "type": "integer",
            "minimum": 0,
            "description": "Running total of quotes/reposts (future-ready)."
          },
          "viewCount": {
            "type": "integer",
            "minimum": 0,
            "description": "Aggregated impressions (populated asynchronously)."
          },
          "viewerHasLiked": {
            "type": "boolean",
            "description": "Whether the requesting user currently likes the post."
          },
          "viewerFollowsAuthor": {
            "type": "boolean",
            "description": "Whether the requesting user follows the post author."
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "content",
          "postType",
          "audienceScope",
          "isArchived",
          "userId",
          "likeCount",
          "commentCount",
          "quoteCount",
          "viewCount",
          "viewerHasLiked",
          "createdAt",
          "updatedAt"
        ]
      },
      "CommentCreate": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "content"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "content": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "content": {
                "type": "string",
                "example": "Nice post!"
              }
            }
          }
        }
      },
      "Comment": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "id": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              },
              "postId": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              },
              "userId": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  }
                }
              },
              "content": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  }
                }
              },
              "createdAt": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "date-time"
                  }
                }
              },
              "updatedAt": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "date-time"
                  }
                }
              },
              "commentCount": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "integer"
                  },
                  "minimum": {
                    "type": "number",
                    "example": 0
                  },
                  "description": {
                    "type": "string",
                    "example": "Updated total number of comments on the post."
                  }
                }
              }
            }
          },
          "required": {
            "type": "array",
            "example": [
              "id",
              "postId",
              "userId",
              "content",
              "createdAt",
              "updatedAt"
            ],
            "items": {
              "type": "string"
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "id": {
                "type": "number",
                "example": 871
              },
              "postId": {
                "type": "number",
                "example": 123
              },
              "userId": {
                "type": "number",
                "example": 4
              },
              "content": {
                "type": "string",
                "example": "Team Phoenix has 3 open slots  DM me if you want in!"
              },
              "createdAt": {
                "type": "string",
                "example": "2025-10-06T17:05:00.000Z"
              },
              "updatedAt": {
                "type": "string",
                "example": "2025-10-06T17:05:00.000Z"
              },
              "commentCount": {
                "type": "number",
                "example": 9
              }
            }
          }
        }
      },
      "DeleteRequestBody": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "password"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "password": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "password"
                  },
                  "description": {
                    "type": "string",
                    "example": "Current password for the logged-in account."
                  }
                }
              },
              "reason": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "maxLength": {
                    "type": "number",
                    "example": 2000
                  },
                  "description": {
                    "type": "string",
                    "example": "Optional context shared with admins when reviewing deletions."
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "password": {
                "type": "string",
                "example": "currentPassword123"
              },
              "reason": {
                "type": "string",
                "example": "Graduated; no longer need campus access"
              }
            }
          }
        }
      },
      "DeleteRequestResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "requestId": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "description": {
                    "type": "string",
                    "example": "Opaque deletion request identifier returned by /users/me/delete-request."
                  }
                }
              },
              "expiresAt": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "date-time"
                  },
                  "description": {
                    "type": "string",
                    "example": "ISO timestamp when the OTP/request expires."
                  }
                }
              },
              "otp": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "description": {
                    "type": "string",
                    "example": "4-digit OTP. Present only when INCLUDE_OTP_IN_RESPONSE=true or NODE_ENV !== \"production\"."
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "requestId": {
                "type": "string",
                "example": "b027e09885bb0885ddd3759b06445ca9"
              },
              "expiresAt": {
                "type": "string",
                "example": "2025-10-01T15:43:09.931Z"
              },
              "otp": {
                "type": "string",
                "example": "8157"
              }
            }
          }
        }
      },
      "DeleteConfirmRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "required": {
            "type": "array",
            "example": [
              "requestId",
              "otp"
            ],
            "items": {
              "type": "string"
            }
          },
          "properties": {
            "type": "object",
            "properties": {
              "requestId": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "minLength": {
                    "type": "number",
                    "example": 1
                  },
                  "description": {
                    "type": "string",
                    "example": "Token returned by delete-request."
                  }
                }
              },
              "otp": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "pattern": {
                    "type": "string",
                    "example": "^[0-9]{4}$"
                  },
                  "description": {
                    "type": "string",
                    "example": "4-digit confirmation code from the email/response."
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "requestId": {
                "type": "string",
                "example": "b027e09885bb0885ddd3759b06445ca9"
              },
              "otp": {
                "type": "string",
                "example": "8157"
              }
            }
          }
        }
      },
      "DeleteConfirmResponse": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "example": "object"
          },
          "properties": {
            "type": "object",
            "properties": {
              "status": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "enum": {
                    "type": "array",
                    "example": [
                      "deleted"
                    ],
                    "items": {
                      "type": "string"
                    }
                  },
                  "description": {
                    "type": "string",
                    "example": "Always \"deleted\" when the confirmation succeeds."
                  }
                }
              },
              "confirmedAt": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "string"
                  },
                  "format": {
                    "type": "string",
                    "example": "date-time"
                  },
                  "description": {
                    "type": "string",
                    "example": "Timestamp when the account was scrubbed and archived."
                  }
                }
              },
              "mailerError": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "example": "boolean"
                  },
                  "nullable": {
                    "type": "boolean",
                    "example": true
                  },
                  "description": {
                    "type": "string",
                    "example": "true when the confirmation email failed to send; account deletion already committed."
                  }
                }
              }
            }
          },
          "example": {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "example": "deleted"
              },
              "confirmedAt": {
                "type": "string",
                "example": "2025-10-01T18:00:11.933Z"
              },
              "mailerError": {
                "type": "boolean",
                "example": false
              }
            }
          }
        }
      },
      "AuthLoginRequest": {
        "type": "object",
        "description": "Credentials for /auth/login. emailOrUsername is trimmed before lookup.",
        "required": [
          "emailOrUsername",
          "password"
        ],
        "properties": {
          "emailOrUsername": {
            "type": "string",
            "description": "Email (case-insensitive) or username (case-sensitive).",
            "example": "alice@example.edu"
          },
          "password": {
            "type": "string",
            "format": "password",
            "description": "Plain password sent over HTTPS.",
            "example": "P@ssw0rd123!"
          }
        }
      },
      "AuthLoginResponse": {
        "type": "object",
        "description": "JWT plus lightweight user profile returned after successful login.",
        "properties": {
          "token": {
            "type": "string",
            "description": "JWT signed with server secret."
          },
          "user": {
            "type": "object",
            "$ref": "#/components/schemas/UserSummary"
          }
        },
        "example": {
          "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
          "user": {
            "id": 42,
            "name": "Alice Doe",
            "username": "alice",
            "email": "alice@example.edu",
            "degreeId": 101,
            "departmentId": 5,
            "designationId": null
          }
        }
      },
      "PostMediaMetadata": {
        "type": "object",
        "description": "Metadata persisted with each attachment. Additional custom keys may be stored alongside these defaults.",
        "properties": {
          "r2Key": {
            "type": "string",
            "description": "Cloudflare R2 object key returned by POST /media/presign."
          },
          "contentType": {
            "type": "string",
            "nullable": true,
            "description": "MIME type supplied during upload (e.g. image/webp)."
          },
          "size": {
            "type": "integer",
            "nullable": true,
            "description": "Object size in bytes."
          },
          "width": {
            "type": "integer",
            "nullable": true,
            "description": "Pixel width when known."
          },
          "height": {
            "type": "integer",
            "nullable": true,
            "description": "Pixel height when known."
          },
          "duration": {
            "type": "number",
            "format": "float",
            "nullable": true,
            "description": "Duration in seconds for video or GIF attachments."
          },
          "order": {
            "type": "integer",
            "nullable": true,
            "description": "Insertion order maintained by the server."
          }
        },
        "additionalProperties": true,
        "example": {
          "r2Key": "users/4/posts/714b3d51-9e1f-4aa2-9f9e-4c2f034b0d0d.webp",
          "contentType": "image/webp",
          "size": 105432,
          "width": 1280,
          "height": 720,
          "order": 0
        }
      },
      "PostMedia": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "type": {
            "type": "string",
            "enum": [
              "image",
              "gif",
              "video"
            ]
          },
          "url": {
            "type": "string",
            "format": "uri"
          },
          "metadata": {
            "$ref": "#/components/schemas/PostMediaMetadata"
          }
        },
        "required": [
          "id",
          "type",
          "url"
        ],
        "example": {
          "id": 1,
          "type": "image",
          "url": "https://cdn.example.edu/media/users/4/posts/714b3d51.webp",
          "metadata": {
            "r2Key": "users/4/posts/714b3d51-9e1f-4aa2-9f9e-4c2f034b0d0d.webp",
            "contentType": "image/webp",
            "size": 105432,
            "width": 1280,
            "height": 720,
            "order": 0
          }
        }
      },
      "PostSummary": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "content": {
            "type": "string"
          },
          "postType": {
            "type": "string"
          },
          "audienceScope": {
            "type": "object",
            "additionalProperties": true
          },
          "user": {
            "$ref": "#/components/schemas/PostAuthor",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "content",
          "postType",
          "audienceScope",
          "createdAt",
          "updatedAt"
        ]
      },
      "PostFeedResponse": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "minimum": 1
          },
          "prevPage": {
            "type": "integer",
            "nullable": true
          },
          "nextPage": {
            "type": "integer",
            "nullable": true
          },
          "limit": {
            "type": "integer",
            "minimum": 1
          },
          "count": {
            "type": "integer",
            "minimum": 0
          },
          "total": {
            "type": "integer",
            "minimum": 0
          },
          "hasMore": {
            "type": "boolean"
          },
          "remaining": {
            "type": "integer",
            "minimum": 0
          },
          "posts": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Post"
            }
          }
        },
        "required": [
          "page",
          "limit",
          "count",
          "total",
          "hasMore",
          "posts"
        ],
        "example": {
          "page": 1,
          "prevPage": null,
          "nextPage": 2,
          "limit": 10,
          "count": 2,
          "total": 5,
          "hasMore": true,
          "remaining": 3,
          "posts": [
            {
              "id": 900,
              "content": "Campus closed tomorrow due to maintenance.",
              "postType": "announcement",
              "pinnedUntil": "2026-03-01T12:00:00.000Z",
              "audienceScope": {
                "target": {
                  "scope": "global"
                },
                "interests": [
                  "announcement:general"
                ]
              },
              "mentions": [],
              "hashtags": [],
              "urls": [],
              "media": [],
              "announcementTypeId": 2,
              "announcementType": {
                "id": 2,
                "typeKey": "campus_notice",
                "displayName": "Campus Notice",
                "description": null
              },
              "userId": 1,
              "user": {
                "id": 1,
                "fullName": "Admin",
                "username": "admin",
                "avatarUrl": null,
                "avatarUrlFull": null,
                "avatarInitial": "A"
              },
              "isArchived": false,
              "likeCount": 0,
              "commentCount": 0,
              "quoteCount": 0,
              "viewCount": 15,
              "viewerHasSeen": false,
              "viewerHasLiked": false,
              "viewerHasSaved": false,
              "viewerFollowsAuthor": false,
              "createdAt": "2026-02-28T08:30:00.000Z",
              "updatedAt": "2026-02-28T08:30:00.000Z"
            },
            {
              "id": 123,
              "content": "Excited for the #Hackathon with @superadmin!",
              "postType": "standard",
              "audienceScope": {
                "target": {
                  "scope": "profile"
                },
                "interests": [
                  "topic:events"
                ]
              },
              "mentions": [
                "superadmin"
              ],
              "hashtags": [
                "hackathon"
              ],
              "urls": [
                "https://example.edu/events/hack"
              ],
              "media": [
                {
                  "id": 1,
                  "type": "image",
                  "url": "https://cdn.example.edu/media/posts/hackathon-poster.webp",
                  "metadata": {
                    "r2Key": "users/4/posts/hackathon-poster.webp",
                    "contentType": "image/webp",
                    "size": 104857,
                    "width": 1024,
                    "height": 576,
                    "order": 0
                  }
                }
              ],
              "quotedPostId": null,
              "parentPostId": null,
              "isArchived": false,
              "announcementTypeId": null,
              "userId": 4,
              "user": {
                "id": 4,
                "fullName": "Ava Admin",
                "username": "ava.admin"
              },
              "likeCount": 42,
              "commentCount": 3,
              "quoteCount": 0,
              "viewCount": 256,
              "viewerHasLiked": false,
              "viewerFollowsAuthor": false,
              "createdAt": "2025-10-06T17:00:00.000Z",
              "updatedAt": "2025-10-06T17:00:00.000Z"
            }
          ]
        }
      },
      "PostEngagementResponse": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean"
          },
          "likeCount": {
            "type": "integer",
            "minimum": 0
          },
          "viewerHasLiked": {
            "type": "boolean"
          }
        },
        "required": [
          "ok",
          "likeCount",
          "viewerHasLiked"
        ],
        "example": {
          "ok": true,
          "likeCount": 7,
          "viewerHasLiked": true
        }
      },
      "MediaPresignRequest": {
        "type": "object",
        "required": [
          "filename",
          "contentType"
        ],
        "properties": {
          "filename": {
            "type": "string",
            "minLength": 1,
            "maxLength": 255,
            "description": "Original client filename. Empty strings are rejected; include the real extension when possible so the backend can preserve it."
          },
          "contentType": {
            "type": "string",
            "description": "Normalized MIME type for the file that will be uploaded.",
            "enum": [
              "image/jpeg",
              "image/png",
              "image/webp",
              "image/gif",
              "video/mp4",
              "video/quicktime",
              "video/webm"
            ]
          },
          "size": {
            "type": "integer",
            "format": "int64",
            "minimum": 1,
            "maximum": 52428800,
            "description": "Optional file size in bytes for pre-flight validation. Must be a positive integer <= 52,428,800 (50MB) when provided."
          }
        },
        "additionalProperties": false,
        "example": {
          "filename": "hackathon-poster.webp",
          "contentType": "image/webp",
          "size": 105432
        }
      },
      "MediaPresignResponse": {
        "type": "object",
        "properties": {
          "uploadUrl": {
            "type": "string",
            "format": "uri",
            "description": "Pre-signed Cloudflare R2 HTTPS PUT URL to which the raw binary should be uploaded."
          },
          "expiresIn": {
            "type": "integer",
            "minimum": 60,
            "description": "Number of seconds before the upload URL expires (defaults to 300s / 5 minutes)."
          },
          "objectKey": {
            "type": "string",
            "description": "Opaque R2 object key; store this under `metadata.r2Key` when creating or updating posts."
          },
          "publicUrl": {
            "type": "string",
            "format": "uri",
            "description": "Public CDN URL that can be saved on the Post attachment."
          },
          "requiredHeaders": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "description": "Headers that must be included when uploading (currently just `Content-Type`)."
          },
          "maxUploadBytes": {
            "type": "integer",
            "enum": [
              52428800
            ],
            "description": "Maximum allowed upload size in bytes (52,428,800 ~ 50MB)."
          }
        },
        "required": [
          "uploadUrl",
          "expiresIn",
          "objectKey",
          "publicUrl",
          "requiredHeaders",
          "maxUploadBytes"
        ],
        "example": {
          "uploadUrl": "https://example-r2.cloudflare.com/put-url",
          "expiresIn": 900,
          "objectKey": "users/4/images/714b3d51.webp",
          "publicUrl": "https://cdn.example.edu/media/users/4/images/714b3d51.webp",
          "requiredHeaders": {
            "Content-Type": "image/webp"
          },
          "maxUploadBytes": 52428800
        }
      },
      "PostAttachments": {
        "type": "array",
        "maxItems": 5,
        "description": "Attach up to 5 images. If a GIF or video is included, it must be the only attachment. Include the `metadata.r2Key` issued by `/media/presign` so the backend can clean up objects.",
        "items": {
          "type": "object",
          "required": [
            "type",
            "url"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "image",
                "gif",
                "video"
              ]
            },
            "url": {
              "type": "string",
              "format": "uri"
            },
            "metadata": {
              "type": "object",
              "nullable": true,
              "description": "Additional media information sent back by the storage presign endpoint.",
              "properties": {
                "r2Key": {
                  "type": "string",
                  "description": "Required: Cloudflare R2 object key for this file."
                },
                "contentType": {
                  "type": "string",
                  "nullable": true
                },
                "size": {
                  "type": "integer",
                  "nullable": true
                },
                "width": {
                  "type": "integer",
                  "nullable": true
                },
                "height": {
                  "type": "integer",
                  "nullable": true
                },
                "duration": {
                  "type": "number",
                  "nullable": true,
                  "description": "Duration in seconds for video/GIF uploads."
                }
              },
              "additionalProperties": true
            }
          },
          "additionalProperties": false
        }
      },
      "PostCreateStandard": {
        "type": "object",
        "required": [
          "content"
        ],
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 2000,
            "description": "Trimmed text, max 2000 characters. Duplicate consecutive posts rejected."
          },
          "attachments": {
            "$ref": "#/components/schemas/PostAttachments"
          }
        },
        "additionalProperties": false,
        "example": {
          "content": "Excited for the #Hackathon with @superadmin!",
          "attachments": [
            {
              "type": "image",
              "url": "https://cdn.example.edu/media/posts/hackathon-poster.webp",
              "metadata": {
                "r2Key": "users/4/posts/hackathon-poster.webp",
                "contentType": "image/webp",
                "size": 104857,
                "width": 1024,
                "height": 576
              }
            }
          ]
        }
      },
      "RepostRequest": {
        "type": "object",
        "description": "Silent repost; no content or attachments allowed. quotedPostId comes from the path parameter.",
        "additionalProperties": false
      },
      "QuotePostCreate": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 2000,
            "nullable": true
          },
          "attachments": {
            "$ref": "#/components/schemas/PostAttachments"
          }
        },
        "additionalProperties": false,
        "description": "Quote post; content or attachments required. quotedPostId is provided as a path parameter.",
        "example": {
          "content": "My take on this",
          "attachments": []
        }
      },
      "ReplyPostCreate": {
        "type": "object",
        "required": [
          "content"
        ],
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 2000
          },
          "attachments": {
            "$ref": "#/components/schemas/PostAttachments"
          }
        },
        "additionalProperties": false,
        "description": "Reply to a post; parentPostId is provided as a path parameter.",
        "example": {
          "content": "Thanks for sharing!",
          "attachments": []
        }
      },
      "PostArchiveRequest": {
        "type": "object",
        "properties": {
          "reason": {
            "type": "string",
            "maxLength": 255,
            "description": "Optional reason shown in audit logs"
          }
        },
        "additionalProperties": false
      },
      "PostArchiveResponse": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean"
          },
          "post": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer"
              },
              "isArchived": {
                "type": "boolean"
              },
              "archivedAt": {
                "type": "string",
                "format": "date-time",
                "nullable": true
              },
              "archivedBy": {
                "type": "string",
                "nullable": true
              },
              "archiveReason": {
                "type": "string",
                "nullable": true
              }
            },
            "required": [
              "id",
              "isArchived"
            ]
          }
        },
        "required": [
          "ok",
          "post"
        ]
      },
      "PostAuthor": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "fullName": {
            "type": "string"
          },
          "username": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "fullName",
          "username"
        ]
      },
      "AnnouncementTypeSummary": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "typeKey": {
            "type": "string"
          },
          "displayName": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "id",
          "typeKey",
          "displayName"
        ]
      },
      "AnnouncementCreateRequest": {
        "type": "object",
        "required": [
          "content",
          "announcementTypeId"
        ],
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 280,
            "description": "Trimmed text, max 280 characters."
          },
          "attachments": {
            "type": "array",
            "maxItems": 5,
            "description": "Attach up to 5 images. A GIF or video must be the sole attachment. Include the `metadata.r2Key` from `/media/presign` for storage cleanup.",
            "items": {
              "type": "object",
              "required": [
                "type",
                "url"
              ],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "image",
                    "gif",
                    "video"
                  ]
                },
                "url": {
                  "type": "string",
                  "format": "uri"
                },
                "metadata": {
                  "type": "object",
                  "nullable": true,
                  "description": "Additional media information persisted alongside the announcement.",
                  "properties": {
                    "r2Key": {
                      "type": "string",
                      "description": "Cloudflare R2 object key returned during presign."
                    },
                    "contentType": {
                      "type": "string",
                      "nullable": true
                    },
                    "size": {
                      "type": "integer",
                      "nullable": true
                    },
                    "width": {
                      "type": "integer",
                      "nullable": true
                    },
                    "height": {
                      "type": "integer",
                      "nullable": true
                    },
                    "duration": {
                      "type": "number",
                      "nullable": true
                    }
                  },
                  "additionalProperties": true
                }
              },
              "additionalProperties": false
            }
          },
          "announcementTypeId": {
            "type": "integer",
            "minimum": 1
          },
          "pinnedUntil": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "AnnouncementUpdateRequest": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 280,
            "description": "Trimmed text, max 280 characters."
          },
          "attachments": {
            "type": "array",
            "maxItems": 5,
            "description": "Attach up to 5 images. A GIF or video must be the sole attachment. Include the `metadata.r2Key` from `/media/presign` for storage cleanup.",
            "items": {
              "type": "object",
              "required": [
                "type",
                "url"
              ],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "image",
                    "gif",
                    "video"
                  ]
                },
                "url": {
                  "type": "string",
                  "format": "uri"
                },
                "metadata": {
                  "type": "object",
                  "nullable": true,
                  "description": "Additional media information persisted alongside the announcement.",
                  "properties": {
                    "r2Key": {
                      "type": "string",
                      "description": "Cloudflare R2 object key returned during presign."
                    },
                    "contentType": {
                      "type": "string",
                      "nullable": true
                    },
                    "size": {
                      "type": "integer",
                      "nullable": true
                    },
                    "width": {
                      "type": "integer",
                      "nullable": true
                    },
                    "height": {
                      "type": "integer",
                      "nullable": true
                    },
                    "duration": {
                      "type": "number",
                      "nullable": true
                    }
                  },
                  "additionalProperties": true
                }
              },
              "additionalProperties": false
            }
          },
          "announcementTypeId": {
            "type": "integer",
            "minimum": 1
          },
          "pinnedUntil": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "AnnouncementResponse": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean"
          },
          "announcement": {
            "$ref": "#/components/schemas/Post"
          }
        },
        "required": [
          "ok",
          "announcement"
        ]
      },
      "AnnouncementListResponse": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "announcements": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Post"
            }
          }
        },
        "required": [
          "page",
          "limit",
          "total",
          "announcements"
        ]
      },
      "FollowActionResponse": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean"
          },
          "alreadyFollowing": {
            "type": "boolean",
            "nullable": true
          },
          "removed": {
            "type": "boolean",
            "nullable": true
          }
        },
        "example": {
          "ok": true,
          "alreadyFollowing": false,
          "removed": false
        }
      },
      "FollowListResponse": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "hasMore": {
            "type": "boolean"
          },
          "nextPage": {
            "type": "integer",
            "nullable": true
          },
          "users": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer"
                },
                "fullName": {
                  "type": "string"
                },
                "username": {
                  "type": "string"
                },
                "avatarUrl": {
                  "type": "string",
                  "nullable": true
                }
              }
            }
          }
        },
        "required": [
          "page",
          "limit",
          "count",
          "total",
          "hasMore",
          "users"
        ]
      },
      "NotificationItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "userId": {
            "type": "integer"
          },
          "actorId": {
            "type": "integer"
          },
          "type": {
            "type": "string",
            "enum": [
              "follow",
              "like",
              "comment",
              "quote",
              "mention"
            ]
          },
          "entityType": {
            "type": "string",
            "enum": [
              "user",
              "post",
              "comment"
            ]
          },
          "entityId": {
            "type": "integer"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          },
          "status": {
            "type": "string",
            "enum": [
              "unread",
              "read"
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "readAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        },
        "required": [
          "id",
          "userId",
          "actorId",
          "type",
          "entityType",
          "entityId",
          "status",
          "createdAt"
        ]
      },
      "NotificationListResponse": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "count": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "hasMore": {
            "type": "boolean"
          },
          "nextPage": {
            "type": "integer",
            "nullable": true
          },
          "notifications": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/NotificationItem"
            }
          }
        },
        "required": [
          "page",
          "limit",
          "count",
          "total",
          "hasMore",
          "notifications"
        ]
      },
      "NotificationReadResponse": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean"
          },
          "notification": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer"
              },
              "status": {
                "type": "string",
                "enum": [
                  "unread",
                  "read"
                ]
              },
              "readAt": {
                "type": "string",
                "format": "date-time",
                "nullable": true
              }
            }
          }
        },
        "example": {
          "ok": true,
          "notification": {
            "id": 9,
            "status": "read",
            "readAt": "2026-01-02T00:00:00.000Z"
          }
        }
      }
    }
  },
  "externalDocs": {
    "description": "Swagger UI (live docs)",
    "url": "/api/docs"
  }
}